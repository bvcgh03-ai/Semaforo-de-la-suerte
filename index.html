<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sem치foro de Lugones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: Arial, sans-serif;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

#contenedor {
  display: flex;
  align-items: center;
  gap: 40px;
}

#logoBtn {
  width: 220px;
  height: 220px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 25px white;
  transition: transform 0.1s;
}

#logoBtn:active {
  transform: scale(0.95);
}

#resultado {
  width: 140px;
  height: 140px;
  border-radius: 50%;
  background: #222;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 22px;
  font-weight: bold;
}
</style>
</head>

<body>

<div id="contenedor">
  <!-- BOT칍N 칔NICO -->
  <img src="logo.png" id="logoBtn" onclick="jugar()">

  <!-- RESULTADO -->
  <div id="resultado">---</div>
</div>

<audio id="ruletaSound" src="https://www.soundjay.com/misc/sounds/slot-machine-1.mp3"></audio>

<script>
let device, characteristic;

async function jugar() {
  // vibraci칩n
  if (navigator.vibrate) navigator.vibrate(200);

  // sonido
  document.getElementById("ruletaSound").play();

  // conectar si no est치 conectado
  if (!characteristic) {
    await conectar();
  }

  // animaci칩n previa
  const r = document.getElementById("resultado");
  r.innerText = "游꿣";
  r.style.background = "#222";

  // mandar orden al ESP32
  characteristic.writeValue(
    new TextEncoder().encode("J")
  );
}

async function conectar() {
  device = await navigator.bluetooth.requestDevice({
    filters: [{ name: 'ESP32_Ruleta' }],
    optionalServices: ['12345678-1234-1234-1234-123456789abc']
  });

  const server = await device.gatt.connect();
  const service = await server.getPrimaryService(
    '12345678-1234-1234-1234-123456789abc'
  );

  characteristic = await service.getCharacteristic(
    'abcd1234-1234-1234-1234-abcdef123456'
  );

  characteristic.startNotifications();
  characteristic.addEventListener(
    'characteristicvaluechanged',
    mostrarResultado
  );
}

function mostrarResultado(e) {
  const valor = new TextDecoder().decode(e.target.value);
  const r = document.getElementById("resultado");

  if (valor === 'R') {
    r.style.background = "red";
    r.innerText = "ROJO";
  }
  if (valor === 'A') {
    r.style.background = "yellow";
    r.style.color = "black";
    r.innerText = "AMARILLO";
  }
  if (valor === 'V') {
    r.style.background = "green";
    r.innerText = "VERDE";
  }
}
</script>

</body>
</html>
